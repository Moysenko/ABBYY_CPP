## Решение

Пусть $left_i = \max\limits_{j \leq i} height_j$, $right_i = \max\limits_{j \geq i} height_j$. Тогда очевидно, что уровень воды над $i$-й ячейкой не может превзойти ни $left_i$, ни $right_i$. Более того, очевидно, что он в точности будет равен минимуму из них. То есть, $height_i$ + [количество клеток с водой над $i$-й ячейкой] = $\min(left_i, right_i)$. Отсюда легко находится количество воды над $i$-й ячейкой. Просуммировав это значение по всем ячейкой, находим ответ

Быстро найти $left_i$ можно рекурсивной формулой: $left_i = \max(left_{i - 1}, height_i)$ - это делается за линию. Аналогично с $right_i$

Итого алгоритм работает за $O(n)$